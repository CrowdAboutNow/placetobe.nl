<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/placetobe-cookie-warning/placetobe-cookie-warning.html">
<link rel="import" href="../../bower_components/placetobe-card/placetobe-card.html">
<link rel="import" href="../../bower_components/placetobe-header/placetobe-header.html">
<link rel="import" href="../../bower_components/placetobe-footer/placetobe-footer.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route-converter.html">
<link rel="import" href="../../bower_components/app-metadata/app-metadata.html">
<link rel="import" href="../../bower_components/placetobe-route/placetobe-route.html">
<link rel="import" href="../../bower_components/placetobe-hero/placetobe-hero.html">
<link rel="import" href="../../bower_components/placetobe-illustrations/placetobe-illustrations.html">
<link rel="import" href="../placetobe-investor-registration-form/placetobe-investor-registration-form.html">
<link rel="import" href="../placetobe-pricing/placetobe-pricing.html">

<dom-module id="placetobe-app">
  <template>
    <style>
      :host placetobe-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 9;
      }

      :host placetobe-hero {
        height: 10vh;
        min-height: 600px;
/*        --placetobe-default-button-color: white;
*/      }

      :host placetobe-hero[hidden] {
        display: none;
      }

      :host placetobe-hero[car-parked] {
        --placetobe-hero-color: var(--placetobe-color-taupe);
      }

      :host placetobe-hero[car-gone] {
        --placetobe-hero-color: var(--placetobe-color-yellow);
      }

      :host .horizontal-layout {
        @apply(--placetobe-border-box);
        @apply(--placetobe-flex-layout--vertical);
        @apply(--placetobe-flex-align--space-between);
        @apply(--placetobe-cross-align--baseline);
        max-width: calc( var(--placetobe-layout-width) + (var(--placetobe-margin) * 2) );
        padding: 0 calc(var(--placetobe-margin));
        margin-left: auto;
        margin-right: auto;
      }

      @media (min-width: 601px) {

        :host .horizontal-layout {
          @apply(--placetobe-flex-layout--horizontal);
        }
        
        :host .horizontal-layout > * {
          @apply(--placetobe-flex-item--1);
        }

        :host .horizontal-layout.layout-50-50 > * {
          max-width: calc(50% - 12px);
        }        

        :host .layout-66-33--item-1 {
          @apply(--placetobe-flex-item--2);
          max-width: calc(66.66666% - 12px);
        }

        :host .layout-66-33--item-2 > *:nth-child(2) {
          @apply(--placetobe-flex-item--1);
          max-width: calc(33.333333% - 12px);
        }

      }

      :host article {
        @apply(--placetobe-font-body);
        padding: auto;
      }

      :host article strong {
        @apply(--placetobe-font-body-bold);
      }

      :host main {
        font-size: 0;
        margin-bottom: -10px;
      }

      :host h1 {
        @apply(--placetobe-font-heading1);
      }

      :host h2 {
        @apply(--placetobe-font-heading1-regular);
      }

      :host section {
        margin-top: calc(var(--placetobe-margin)*1.25);
        margin-bottom: calc(var(--placetobe-margin)*1.25);
      }

      :host #pricing {
        margin-top: calc( var(--placetobe-margin) * 8 );
      }

      placetobe-cookie-warning {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 10;
      }

      placetobe-footer placetobe-investor-registration-form {
        margin: var(--placetobe-margin) 0;
      }

      placetobe-footer h2 {
        @apply(--placetobe-font-heading3);
        color: white;
      }

    </style>

    <template is="dom-if" if="[[!cookiesAccepted]]">
      <placetobe-cookie-warning
        on-cookies-accepted="_handleCookiesAccepted"
      ></placetobe-cookie-warning>
    </template>

    <app-location
      route="{{route}}"
    ></app-location>

    <placetobe-route
      route="{{route}}"
      pattern="/:page"
      data="{{routeData}}"
      tail="{{subroute}}"
    ></placetobe-route>

    <placetobe-route
      route="{{subroute}}"
      pattern="/:subpage"
      data="{{subrouteData}}"
    ></placetobe-route>

    <placetobe-header
      collapsed="[[headerCollapsed]]"
      current-page="[[routeData.page]]"
      home-page-active="{{homePageActive}}"
      entrepreneur-page-active="{{entrepreneurPageActive}}"
      invest-page-active="{{investPageActive}}"
      campaign-page-active="{{campaignPageActive}}"
    ></placetobe-header>

    <placetobe-hero
      car-parked$="[[investPageActive]]"
      car-gone$="[[entrepreneurPageActive]]"
      hidden$="[[!landingPageActive]]"
      >

      <main slot="main">

        <span hidden$="[[!homePageActive]]">
          <h2>Iedereen heeft een plek nodig. <strong>Een plek om te wonen</strong>, werken, ondernemen, relaxen... Een plek om te zijn.</h2>      
          <placetobe-button href="/start-project"><span>Hoe start ik een project</span></placetobe-button>
          <placetobe-button href="/investeren" link><span>Info voor investeerders</span></placetobe-button>
        </span>
        
        <span hidden$="[[!entrepreneurPageActive]]">
          <h2><strong>Geen gebouw neerzetten, maar een plek maken.</strong> Vastgoed ontwikkel je samen met de crowd.</h2>      
          <placetobe-button href="https://docs.google.com/forms/d/e/1FAIpQLSdFZhTSDI4kRKZlLedroXEmMCEAGVB6fUPSYJkdIL9jrQR1yg/viewform" target="_blank"><span>Direct je project starten</span></placetobe-button>
          <placetobe-button href="/tarieven" link><span>Bekijk onze tarieven</span></placetobe-button>
        </span>
        
        <span hidden$="[[!investPageActive]]">
          <h2><strong>Crowdfunding in vastgoed.</strong> Iedereen een plek en jij rendement.</h2>      
          <placetobe-button href="/investeren/aanmelden"><span>Meld je aan als investeerder</span></placetobe-button>
          <placetobe-button href="/investeren/test" link><span>Doe de quickscan</span></placetobe-button>
        </span>
        
      </main>

      <placetobe-manholdingkey-illustration slot="illustration" hidden$="[[!homePageActive]]"></placetobe-manholdingkey-illustration>
      <placetobe-manreading-illustration slot="illustration" hidden$="[[!entrepreneurPageActive]]"></placetobe-manreading-illustration>
      <placetobe-manthinking-illustration slot="illustration" hidden$="[[!investPageActive]]"></placetobe-manthinking-illustration>
      
    </placetobe-hero>

    <template is="dom-if" if="[[pricingPageActive]]">

      <section
        id="pricing"
        class="horizontal-layout"      
        >
        <article>
        <h2>Wat kost dat nou?</h2>
        <h1>Tarieven voor crowfdfunden bij Placetobe</h1>
        
          <p>We begeleiden het hele proces en geven je advies over campagne voeren en hoe je betrokken investeerders vindt. Ook zorgen we ervoor dat de financiële afhandeling tot in de puntjes geregeld is.</p>
        </article>

      </section>

        <placetobe-pricing></placetobe-pricing>

      <section class="horizontal-layout">

        <article>
          <p>Bij vastgoed hoort altijd financiering, maar voor veel 'kleinere' projecten blijft het bankloket helaas gesloten. Komt jouw project daardoor ook niet van de grond? Crowdfunding biedt nieuwe kansen. We bereiken een grote groep investeerders en gebruikers. Samen realiseren we vastgoed.</p>
        </article>
      </section>

      <section class="horizontal-layout">
        
        <placetobe-card title="Project starten?">
          
          <article slot="main">Financiering nodig voor een vastgoedproject? Misschien is crowdfunding de manier voor jou.</article>
          
          <placetobe-button
            href="/start-project"
            title="Meer info"
            slot="footer"
          ><span>Meer info</span>
          </placetobe-button>

        </placetobe-card>

      </section>

    </template>


    <template is="dom-if" if="[[landingPageActive]]">

      <section class="horizontal-layout layout-66-33">

          <template is="dom-if" if="[[homePageActive]]">
            <main class="layout-66-33--item-1">
              <h1>Nieuwe kansen voor de vastgoedmarkt</h1>
              <article>
                <p><strong>Wij vinden dat de vastgoedmarkt anders kan. Makkelijker, eerlijker, en vooral: beter voor elkaar. Het is toch gek dat de bank met haar leningen zoveel invloed heeft op hoe we wonen, werken, leven? Laten we liever samen beslissen waar behoefte aan is, en wat het verdient om financiering te krijgen.</strong>
                </p><p>
                Met Placetobe brengen we ontwikkelaars, investeerders en gebruikers bij elkaar en zorgen we voor financiering, rendement én een gewilde plek. Een win-win-win voor iedereen.
                </p>
              </article>
            </main>
          </template>

          <template is="dom-if" if="[[investPageActive]]">
            <main class="layout-66-33--item-1">
              <h1>Investeren in vastgoed met placetobe</h1>
              <article>
                <p><strong>Zie je je spaarkapitaal bij de bank meer krimpen dan groeien, maar is beleggen in aandelen net een stap te ver? Investeren in vastgoed via crowdfunding is een veilige en gebruiksvriendelijke manier van beleggen. Niet alleen ontvang je meer rendement, je helpt vastgoedprojecten realiseren die jou aanspreken. Crowdfunden is waarde creëren voor jezelf en de omgeving. </strong><p>Placetobe is voor de spaarder die meer rendement wil en de investeerder die bijzondere beleggingsprojecten zoekt. We zijn ervaren in crowdfunding en vastgoed en weten projecten op hun haalbaarheid en succes te toetsen.</p>
              </article>
            </main>
          </template>

          <template is="dom-if" if="[[entrepreneurPageActive]]">
            <main class="layout-66-33--item-1">
              <h1>Vastgoed crowdfunden met placetobe</h1>
              <article>
                
                <p>Bij vastgoed hoort altijd financiering, maar voor veel 'kleinere' projecten blijft het bankloket helaas gesloten. Komt jouw project daardoor ook niet van de grond? Crowdfunding biedt nieuwe kansen. We bereiken een grote groep investeerders en gebruikers. Samen realiseren we vastgoed.</p>

                <p>Placetobe is opgericht door een crowdfundpartij en een vastgoedontwikkelaar. Wij willen dat de vastgoedmarkt minder over geld en gebouwen gaat en meer over mensen en hun behoeftes.</p>
                <p>We begeleiden het hele proces en geven je advies over campagne voeren en hoe je betrokken investeerders vindt. Ook zorgen we ervoor dat de financiële afhandeling tot in de puntjes geregeld is.</p>
              </article>
            </main>
          </template>

        <placetobe-card title="Meer informatie?" id="meer-informatie">
          <article slot="main">Schrijf je in voor onze mailinglist en ontvang de brochure.</article>
          <placetobe-investor-registration-form slot="footer"></placetobe-investor-registration-form>
          </placetobe-button>
        </placetobe-card>
      </section>

      <section class="horizontal-layout layout-50-50">

        <placetobe-card title="Project starten?" id="project-starten">
          <article slot="main">Financiering nodig voor een vastgoedproject? Misschien is crowdfunding de manier voor jou.</article>
          <placetobe-button
            href="/start-project"
            title="Meer info"
            slot="footer"
          ><span>Meer info</span>
          </placetobe-button>
        </placetobe-card>

        <placetobe-card title="Investeren in een project?" id="investeren-in-een-project">
          <article slot="main">wil je investeren in vastgoed? Ontdek of crowdfunding bij je past</article>
          <placetobe-button
            href="/investeren/quickscan"
            title="Doe de quickscan"
            slot="footer"
          ><span>Doe de quickscan</span>
          </placetobe-button>
        </placetobe-card>

      </section>
    </template>

    <placetobe-footer>
      <div>
        <h2>Meer info over investeren?</h2>
        <placetobe-investor-registration-form
          horizontal-layout
          hide-first-name
          hide-last-name
        ></placetobe-investor-registration-form>
      </div>
    </placetobe-footer>

  </template>

  <script>
    Polymer({

      is: 'placetobe-app',

      properties: {

        route: {
          type: Object,
          observer: "routeChanged"
        },

        routeData: {
          type: Object,
          value: {}
        },

        subroute: {
          type: Object,
          value: {}
        },

        subrouteData: {
          type: Object,
          value: {}
        },

        homePageActive: {
          type: Boolean,
          value: false
        },

        entrepreneurPageActive: {
          type: Boolean,
          value: false
        },

        investPageActive: {
          type: Boolean,
          value: false
        },

        campaignPageActive: {
          type: Boolean,
          value: false
        },

        headerCollapsed: {
          type: Boolean,
          computed: "_computeHeaderCollapsed(scrollY)",
          reflectToAttribute: true          
        },

        landingPageActive: {
          type: Boolean,
          computed: '_computeLandingPageActive(homePageActive, investPageActive, entrepreneurPageActive, routeData.*, subrouteData.*)'
        },

        pricingPageActive: {
          type: Boolean,
          computed: '_computePricingPageActive(routeData.page)'
        },

        cookiesAccepted: {
          type: Boolean,
          value: false
        },

        scrollY: {
          type: String,
          value: 0,
          readOnly: true
        },

      },

      observers: [
        "_setMetaData(route.path)"
      ],

      ready: function() {
        this.routeChanged();
        this.cookiesAccepted = window.localStorage.getItem('placetobe-cookies-accepted');
        window.addEventListener('scroll', this._handleScroll.bind(this));
      },

      attached: function() {
        Polymer.AppMetadata.requestAvailability();
        this._setMetaData();
      },

      downloadBrochure: function() {
        var downloadElement = document.createElement('a');
        downloadElement.setAttribute('download', true);
        downloadElement.href = 'https://firebasestorage.googleapis.com/v0/b/placetobe-nl.appspot.com/o/Placetobe_Factsheet_versie_6.pdf?alt=media&token=c43f38ea-9413-4640-8a0f-edf62b641e5a';
        downloadElement.click();
      },

      routeChanged: function(newRoute, oldRoute) {
        var routeExists = (newRoute || {path:""}).path.match(/^(\/(start-project|investeren|tarieven|campagnes)(|\/test|\/aanmelden)|(\/|))$/g);
        if(!routeExists) history.replaceState({}, "Placetobe", "/");
        if(!(newRoute && oldRoute)) return;
        if(newRoute.path !== oldRoute.path) this._handleRouteChanged(newRoute.path, oldRoute.path);
      },

      _handleScroll: function() {
        this._setScrollY(window.scrollY || document.documentElement.scrollTop);
      },

      _computeHeaderCollapsed: function(scrollY) {
        return (scrollY > 54)
      },

      _handleRouteChanged: function(newPath, oldPath) {
        window.scrollTo(0,0)
        this.fire('app-metadata', {
          title: 'This is the page title',
          description: 'This is the page description',
          keywords: 'these,are,keywords'
        });
      },

      _handleCookiesAccepted: function() {
        window.localStorage.setItem('placetobe-cookies-accepted', true);
        this.cookiesAccepted = window.localStorage.getItem('placetobe-cookies-accepted');
      },

      _setMetaData: function(path) {
        switch(this.route.path) {
          default:
            this.fire('app-metadata', {
              title: this._parseDocumentTitle('Vastgoed crowdfunding'),
              description: 'Dé plek voor het crowdfunden van vastgoed in Nederland.'
            });
            break;
          case "/investeren":
            this.fire('app-metadata', {
              title: this._parseDocumentTitle('Investeren in vastgoed'),
              description: 'De betrouwbaarste vorm van beleggen. Gebruiksvriendelijk. Veilig. Samen.'
            });
            break;
          case "/investeren/test":
            this.fire('app-metadata', {
              title: this._parseDocumentTitle('Quickscan investeerders'),
              description: 'Beantwoord 5 vragen en vind uit of jij een vastgoed crowdfunder bent.'
            });
            break;
          case "/investeren/aanmelden":
            this.fire('app-metadata', {
              title: this._parseDocumentTitle('Aanmelden als investeerder'),
              description: 'Dé plek voor het crowdfunden van vastgoed in Nederland.'
            });
            break;
          case "/start-project":
            this.fire('app-metadata', {
              title: this._parseDocumentTitle('Start een project'),
              description: 'Wij helpen je de crowdfunders te vinden voor jouw vastgoedproject.'
            });
            break;
          case "/tarieven":
            this.fire('app-metadata', {
              title: this._parseDocumentTitle('Tarieven'),
              description: 'We begeleiden het hele proces en geven je advies over campagne voeren en hoe je betrokken investeerders vindt.'
            });
            break;
        }
      },

      _parseDocumentTitle: function(pageTitle) {
        return [pageTitle, "Placetobe"].join(" | ");
      },

      _computeLandingPageActive: function(homePageActive, investPageActive, entrepreneurPageActive, routedataitem, subroutedataitem) {
        var landingPageActive = ((homePageActive || investPageActive || entrepreneurPageActive) && (!subroutedataitem.base.subpage));
        return landingPageActive;
      },

      _computePricingPageActive: function(page) {
        return (page == 'tarieven');
      }

    });
  </script>
</dom-module>
