<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/placetobe-cookie-warning/placetobe-cookie-warning.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-route/app-route-converter.html">
<link rel="import" href="../../bower_components/app-metadata/app-metadata.html">
<link rel="import" href="../placetobe-header/placetobe-header.html">
<link rel="import" href="../placetobe-hero/placetobe-hero.html">
<link rel="import" href="../placetobe-styles/placetobe-styles.html">
<link rel="import" href="../placetobe-button/placetobe-button.html">
<link rel="import" href="../placetobe-pricing/placetobe-pricing.html">
<link rel="import" href="../placetobe-action-block/placetobe-action-block.html">
<link rel="import" href="../placetobe-menu/placetobe-menu.html">
<link rel="import" href="../placetobe-investor-registration-form/placetobe-investor-registration-form.html">

<dom-module id="placetobe-app">
  <template>
    <style>
      :host {
        display: block;
        margin: 0;
      }

      :host placetobe-hero {
        margin-bottom: 0;
      }

      :host .intro {
        margin: 36px auto;
        max-width: var(--placetobe-layout-width);
        max-height: 9999px;
        padding: 0 36px;
        display: flex;  
      }

        :host .intro > * {
          flex: 1;
        }

        @media (max-width: 1044px) {
          :host .intro {
            display: block;
          }
          :host .intro > *, :host .intro > article {
            flex: none;
            padding-right: 0;
          }
        }

        :host .intro > article {
          flex: 2;
          padding-right: 18px;
        }

        :host .intro aside {
          margin-top: -28px;
          z-index: 4;
        }

      @media (max-width: 1044px) {
        :host .intro {
          padding: 0 18px;  
          margin: 36px auto 18px auto;
        }
      }

      @media (max-width: 1044px) {
        :host .intro {
          max-width: 100%;
        }
      }

      :host .intro h1 {
        @apply(--placetobe-heading1);
        margin-bottom: 24px;
      }

      :host .intro h2 {
        @apply(--placetobe-heading2);
        margin-bottom: 24px;
      }

      @media (max-width: 1044px) {

        :host .intro h1 {
          @apply(--placetobe-heading1--mobile);
          margin-bottom: 18px;
        }    

        :host .intro h2 {
          @apply(--placetobe-heading2--mobile);
          margin-bottom: 18px;
        }        
      }

      :host .intro article {
        @apply(--placetobe-body);
      }

      :host .intro article strong {
        @apply(--placetobe-body-bold);
      }

      @media (max-width: 959px) {
        :host .intro article {
          @apply(--placetobe-body--phone);
        }        
      }

      :host #calls:not([hidden]) {
        @apply(--placetobe-two-column-layout);
      }

      @media (max-width: 1044px) {
        :host #calls:not([hidden]) {
          @apply(--placetobe-two-column-layout--phone);
        }
      }

      :host #calls > * {
        @apply(--placetobe-two-column-item);
          margin-bottom: 36px;
          flex: none;
      }

      @media (max-width: 1044px) {
        :host #calls > * {
          max-width: 100%;
          margin-bottom: 18px;
        }
      }

      :host placetobe-pricing[hidden] {
        display: none;
      }

      :host #call-to-entrepreneur {
      }

      :host #call-to-investor {
        background-color: var(--placetobe-taupe);
      }

      @media (max-width: 959px) {

        :host placetobe-menu {
          position: fixed;
          top: 0;
          bottom:0;
          z-index: 5;
        }

        :host[menu-hidden] placetobe-menu {
          display: none;
        }
      }

      :host .large-action-block:not([hidden]) {
        display: block;
        max-width: var(--placetobe-layout-width);
        margin: 36px auto;
      }

      @media (max-width: 1044px) {
        :host .large-action-block:not([hidden]) {
/*          margin: 36px 18px;
*/        }
      }

      :host placetobe-menu placetobe-investor-registration-form {
        --submit-button-color: var(--placetobe-taupe);
        position: relative;
        z-index: 1;
        margin-bottom: 36px;
      }

      :host placetobe-menu placetobe-investor-registration-form h3 {
        @apply(--placetobe-heading3);
        width: var(--placetobe-column-width);
        color: white;
        margin: 0 auto 18px auto;
      }

      :host #pricing {
        padding-top: 108px;
      }

      :host #pricing h1, :host #pricing h2 {
        margin: 0;
      }

      :host #pricing h1 {
        margin-bottom: 36px;
      }

      :host #pricing h2 {
        font-weight: 400;
      }

      :host placetobe-cookie-warning {
        display: block;
        width: 100%;
        position: fixed;
        bottom:0;
        z-index: 9;
      }

    </style>

    <template is="dom-if" if="[[!cookiesAccepted]]">
      <placetobe-cookie-warning
        on-cookies-accepted="_handleCookiesAccepted"
      ></placetobe-cookie-warning>
    </template>

    <app-location
      route="{{route}}"
    ></app-location>

    <app-route
      route="{{route}}"
      pattern="/"
      data="{{routeData}}"
      active="{{homePageActive}}"
    ></app-route>

    <app-route
      route="{{route}}"
      pattern="/investeren"
      data="{{routeData}}"
      active="{{investPageActive}}"
      tail="{{investSubroute}}"
    ></app-route>

    <app-route
      route="{{route}}"
      pattern="/start-project"
      data="{{routeData}}"
      active="{{entrepreneurPageActive}}"
      tail="{{entrepreneurSubroute}}"
    ></app-route>

    <app-route
      route="{{route}}"
      pattern="/tarieven"
      data="{{routeData}}"
      active="{{pricingPageActive}}"
    ></app-route>

    <app-route
      route="{{entrepreneurSubroute}}"
      pattern="/test"
      data="{{entrepreneurSubrouteData}}"
      active="{{entrepreneurTestPageActive}}"
    ></app-route>

    <app-route
      route="{{investSubroute}}"
      pattern="/test"
      data="{{investSubrouteData}}"
      active="{{investQuickscanPageActive}}"
    ></app-route>

    <app-route
      route="{{investSubroute}}"
      pattern="/aanmelden"
      data="{{investSubrouteData}}"
      active="{{investRegisterPageActive}}"
    ></app-route>

    <placetobe-header
      menu-hidden="{{menuHidden}}"
      scrolled="{{headerScrolled}}"
      home-page-active="[[homePageActive]]"
      invest-page-active="[[investPageActive]]"
      entrepreneur-page-active="[[entrepreneurPageActive]]"
    ></placetobe-header>

    <template is="dom-if" if="[[!pricingPageActive]]">
      <placetobe-hero
        home-page-active="[[homePageActive]]"
        invest-page-active="[[investPageActive]]"
        entrepreneur-page-active="[[entrepreneurPageActive]]"
        entrepreneur-test-page-active="[[entrepreneurTestPageActive]]"
        invest-quickscan-page-active="[[investQuickscanPageActive]]"
        invest-register-page-active="[[investRegisterPageActive]]"
      ></placetobe-hero>
    </template>

    <template is="dom-if" if="[[pricingPageActive]]">

      <section
        id="pricing"
        class="intro"
        >
        <article>
        <h2>Wat kost dat nou?</h2>
        <h1>Tarieven voor crowfdfunden bij Placetobe</h1>
        
          <p>We begeleiden het hele proces en geven je advies over campagne voeren en hoe je betrokken investeerders vindt. Ook zorgen we ervoor dat de financiële afhandeling tot in de puntjes geregeld is.</p>
        </article>

      </section>

        <placetobe-pricing></placetobe-pricing>

      <section class="intro">

        <article>
          <p>Bij vastgoed hoort altijd financiering, maar voor veel 'kleinere' projecten blijft het bankloket helaas gesloten. Komt jouw project daardoor ook niet van de grond? Crowdfunding biedt nieuwe kansen. We bereiken een grote groep investeerders en gebruikers. Samen realiseren we vastgoed.</p>
        </article>
      </section>

      <placetobe-action-block
        class="large-action-block"
        title="Project starten?"
        action-label="Meer info"
        action-url="/start-project"
        target="entrepreneurs"
      >Financiering nodig voor een vastgoedproject? Misschien is crowdfunding de manier voor jou.
      </placetobe-action-block>

    </template>

    <section class="intro">

      <!-- / -->
      <template is="dom-if" if="[[homePageActive]]">
        <article>
        <h1>Nieuwe kansen voor de vastgoedmarkt</h1>
        <p>
        <strong>Wij vinden dat de vastgoedmarkt anders kan. Makkelijker, eerlijker, en vooral: beter voor elkaar. Het is toch gek dat de bank met haar leningen zoveel invloed heeft op hoe we wonen, werken, leven? Laten we liever samen beslissen waar behoefte aan is, en wat het verdient om financiering te krijgen.</strong>
        <p>Met Placetobe brengen we ontwikkelaars, investeerders en gebruikers bij elkaar en zorgen we voor financiering, rendement én een gewilde plek. Een win-win-win voor iedereen.
        </article>
      </template>

      <!-- /investeren -->
      <template is="dom-if" if="[[investPageActive]]">
        <article>
        <h1>Investeren in vastgoed met placetobe</h1>
        <strong>Zie je je spaarkapitaal bij de bank meer krimpen dan groeien, maar is beleggen in aandelen net een stap te ver? Investeren in vastgoed via crowdfunding is een veilige en gebruiksvriendelijke manier van beleggen. Niet alleen ontvang je meer rendement, je helpt vastgoedprojecten realiseren die jou aanspreken. Crowdfunden is waarde creëren voor jezelf en de omgeving.  </strong>
        <p>Placetobe is voor de spaarder die meer rendement wil en de investeerder die bijzondere beleggingsprojecten zoekt. We zijn ervaren in crowdfunding en vastgoed en weten projecten op hun haalbaarheid en succes te toetsen. 
        </p>
        </article>
      </template>

      <!-- /start-project -->
      <template is="dom-if" if="[[entrepreneurPageActive]]">
        <article>
        <h1>Vastgoed crowdfunden met placetobe</h1>
        <strong>Bij vastgoed hoort altijd financiering, maar voor veel 'kleinere' projecten blijft het bankloket helaas gesloten. Komt jouw project daardoor ook niet van de grond? Crowdfunding biedt nieuwe kansen. We bereiken een grote groep investeerders en gebruikers. Samen realiseren we vastgoed.</strong>
        <p>Placetobe is opgericht door een crowdfundpartij en een vastgoedontwikkelaar. Wij willen dat de vastgoedmarkt minder over geld en gebouwen gaat en meer over mensen en hun behoeftes.<p>We begeleiden het hele proces en geven je advies over campagne voeren en hoe je betrokken investeerders vindt. Ook zorgen we ervoor dat de financiële afhandeling tot in de puntjes geregeld is.
        </p>
        </article>
      </template>

      <aside hidden$="[[pricingPageActive]]">

        <placetobe-action-block
          class="large-action-block"
          title="Meer informatie?"
        >
          Schrijf je in voor onze mailinglist en ontvang de brochure.

          <placetobe-investor-registration-form
            button-label="Download brochure"
            on-register="downloadBrochure"
          ></placetobe-investor-registration-form>

        </placetobe-action-block>

      </aside>

    </section>

    <template is="dom-if" if="[[!investSubPageActive]]">

      <placetobe-action-block
        class="large-action-block"
        title="Ben jij een crowdfunder?"
        action-label="doe de quickscan"
        action-url="/investeren/test"
        target="investors"
        hidden$="[[!investPageActive]]"
      >Beantwoord vijf vragen en ontdek of investeren bij Placetobe iets voor je is.
      </placetobe-action-block>

    </template>

    <template is="dom-if" if="[[!entrepreneurTestPageActive]]">

      <placetobe-action-block
        class="large-action-block"
        title="Heb jij een placetobe?"
        action-label="Project aanmelden"
        action-url="https://docs.google.com/forms/d/e/1FAIpQLSdFZhTSDI4kRKZlLedroXEmMCEAGVB6fUPSYJkdIL9jrQR1yg/viewform"
        target="entrepreneurs"
        hidden$="[[!entrepreneurPageActive]]"
        external-action
      >Meld direct online je project aan.
      </placetobe-action-block>

      <section
        id="calls"
        hidden$="[[!homePageActive]]"
        >

        <placetobe-action-block
          title="Project starten?"
          action-label="Meer info"
          action-url="/start-project"
          target="entrepreneurs"
        >Financiering nodig voor een vastgoedproject? Misschien is crowdfunding de manier voor jou.
        </placetobe-action-block>

        <placetobe-action-block
          title="Investeren in een project?"
          action-label="Doe de quickscan"
          action-url="/investeren/test"
          target="investors"
        >Wil je investeren in vastgoed? Ontdek of crowdfunding bij je past.
        </placetobe-action-block>

      </section>

    </template>

    <placetobe-menu
      for-home-page$="[[homePageActive]]"
      for-invest-page$="[[entrepreneurPageActive]]"
      for-entrepreneur-page$="[[investPageActive]]"
      on-link-tap="hideMenu"
      scrolled="[[headerScrolled]]"
    >

    <placetobe-investor-registration-form
      hide-first-name
      hide-last-name
      horizontal-layout
    >
      <h3>Alles weten over onze nieuwe projecten?</h3>
    </placetobe-investor-registration-form>


    </placetobe-menu>

  </template>

  <script>
    Polymer({

      is: 'placetobe-app',

      properties: {
        route: {
          type: Object,
          observer: "routeChanged"
        },
        routeData: Object,
        entrepreneurSubroute: Object,
        entrepreneurSubrouteData: Object,
        investSubroute: Object,
        investSubrouteData: Object,
        homePageActive: Boolean,
        investPageActive: Boolean,
        entrepreneurPageActive: Boolean,
        entrepreneurTestPageActive: Boolean,
        investQuickscanPageActive: Boolean,
        investRegisterPageActive: Boolean,
        investSubPageActive: {
          type: Boolean,
          computed: "_computeInvestSubPageActive(investQuickscanPageActive, investRegisterPageActive)"
        },
        menuHidden: {
          type: Boolean,
          value: true,
          reflectToAttribute: true
        },
        headerScrolled: {
          type: Boolean,
          reflectToAttribute: true          
        },
        cookiesAccepted: {
          type: Boolean,
          value: false
        }
      },

      observers: [
        "_setMetaData(route.path)"
      ],

      ready: function() {
        this.routeChanged();
        this.cookiesAccepted = window.localStorage.getItem('placetobe-cookies-accepted');
      },

      attached: function() {
        Polymer.AppMetadata.requestAvailability();
        this._setMetaData();
      },

      downloadBrochure: function() {
        var downloadElement = document.createElement('a');
        downloadElement.setAttribute('download', true);
        downloadElement.href = 'https://firebasestorage.googleapis.com/v0/b/placetobe-nl.appspot.com/o/Placetobe_Factsheet_versie_6.pdf?alt=media&token=c43f38ea-9413-4640-8a0f-edf62b641e5a';
        downloadElement.click();
      },

      _computeInvestSubPageActive: function(investQuickscanPageActive, investRegisterPageActive) {
        return (investQuickscanPageActive === true || investRegisterPageActive === true)
      },

      routeChanged: function(newRoute, oldRoute) {
        var routeExists = (newRoute || {path:""}).path.match(/^(\/(start-project|investeren|tarieven)(|\/test|\/aanmelden)|(\/|))$/g);
        if(!routeExists) history.replaceState({}, "Placetobe", "/");
        if(!(newRoute && oldRoute)) return;
        if(newRoute.path !== oldRoute.path) this._handleRouteChanged(newRoute.path, oldRoute.path);
      },

      _handleRouteChanged: function(newPath, oldPath) {
        window.scrollTo(0,0)
        this.fire('app-metadata', {
          title: 'This is the page title',
          description: 'This is the page description',
          keywords: 'these,are,keywords'
        });
      },

      showMenu: function() {
        this.menuHidden = false;
      },

      hideMenu: function() {
        var self = this;
        window.setTimeout(function() {
          self.menuHidden = true;
        }, 50)
      },

      _handleCookiesAccepted: function() {
        window.localStorage.setItem('placetobe-cookies-accepted', true);
        this.cookiesAccepted = window.localStorage.getItem('placetobe-cookies-accepted');
      },

      _setMetaData: function(path) {
        switch(this.route.path) {
          default:
            this.fire('app-metadata', {
              title: this._parseDocumentTitle('Vastgoed crowdfunding'),
              description: 'Dé plek voor het crowdfunden van vastgoed in Nederland.'
            });
            break;
          case "/investeren":
            this.fire('app-metadata', {
              title: this._parseDocumentTitle('Investeren in vastgoed'),
              description: 'De betrouwbaarste vorm van beleggen. Gebruiksvriendelijk. Veilig. Samen.'
            });
            break;
          case "/investeren/test":
            this.fire('app-metadata', {
              title: this._parseDocumentTitle('Quickscan investeerders'),
              description: 'Beantwoord 5 vragen en vind uit of jij een vastgoed crowdfunder bent.'
            });
            break;
          case "/investeren/aanmelden":
            this.fire('app-metadata', {
              title: this._parseDocumentTitle('Aanmelden als investeerder'),
              description: 'Dé plek voor het crowdfunden van vastgoed in Nederland.'
            });
            break;
          case "/start-project":
            this.fire('app-metadata', {
              title: this._parseDocumentTitle('Start een project'),
              description: 'Wij helpen je de crowdfunders te vinden voor jouw vastgoedproject.'
            });
            break;
          case "/tarieven":
            this.fire('app-metadata', {
              title: this._parseDocumentTitle('Tarieven'),
              description: 'We begeleiden het hele proces en geven je advies over campagne voeren en hoe je betrokken investeerders vindt.'
            });
            break;
        }
      },

      _parseDocumentTitle: function(pageTitle) {
        return [pageTitle, "Placetobe"].join(" | ");
      }

    });
  </script>
</dom-module>
