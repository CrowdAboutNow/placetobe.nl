<!--
A routing element for all campaign(s) related pages.

Example:

    <placetobe-campagnes-page
    campaign-route="{{subRoute}}"
    ></placetobe-campagnes-page>
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/placetobe-route/placetobe-route.html">
<link rel="import" href="../../bower_components/placetobe-campaign-page/placetobe-campaign-page.html">
<link rel="import" href="placetobe-landing-page-styles.html">
<link rel="import" href="placetobe-investment-failed-notice.html">


<dom-module id="placetobe-campagnes-page">
  <template>
    <style>
      :host {
        display: block;
      }

      :host h1 {
        margin-top: calc( var(--placetobe-margin) * 8 );
      }

      [hidden] {
        display: none;
      }
    </style>

    <!-- obtaines campaign(s) route from parent and exposes information about campaign(s) (for example campaignId).-->
    <!--TODO: pattern :campaignId can also be /all so name not optimal -->
    <placetobe-route
      route="{{campaignRoute}}"
      pattern="/:campaignId"
      data="{{routeData}}"
      tail="{{subRoute}}"
    ></placetobe-route>

    <!-- Gathers campaign(s) specific information for remaining route, for example post invest status -->
    <placetobe-route
      route="{{subRoute}}"
      pattern="/:status"
      data="{{subRouteData}}"
    ></placetobe-route>

    <!-- If routeData indicates that the page is about one campaign and if there is no subRouteData (for example post invest)-->
    <template is="dom-if" if="{{!subRouteData.status}}">
      <placetobe-campaign-page api-endpoint="[[apiEndpoint]]" campaign-id="{{routeData.campaignId}}"></placetobe-campaign-page>
    </template>
    
    <!-- If post invest was unsuccesful (route: /campagnes/:campaignId/reject)  -->
    <template is="dom-if" if="{{_investmentFailed)}}">
      <placetobe-investment-failed-notice failure-reason="{{subRouteData.status}}"></placetobe-investment-failed-notice>
    </template>

    <!-- If post invest was succesful (route: /campagnes/:campaignId/success)  -->
    <template is="dom-if" if="{{_investmentSuccessfull)}}">
      <h1>Investering succesvol</h1>     
    </template>
    
  </template>
  <script>
    Polymer({
      is: 'placetobe-campagnes-page',
      properties: {
        /**
        * Remaining route information of url that starts with /campagnes/:campaignId
        * campaignRoute.campaignId provides string is :campaignId
        */
        campaignRoute : {
          type: Object
        },
        
        /**
        * location to milestones on Firebase
        */
        apiEndpoint: {
          type: String
        },
        
        /**
        * Remaining route information of 'end' of url, from /campagnes/:campaignId/:status
        * subRouteData.status provides string in :status
        */
        subRouteData: {
          type: Object
        },

        /*
        * Whether the route had a :status /campagnes/:campaignId/:status equal to success
        */
        investmentSuccessfull: {
          type: Boolean,
          value: false,
          computed: '_statusIsOneOf(subRouteData.status, ["success"])'
        },

        /*
        * Whether the route had a :status /campagnes/:campaignId/:status equal to reject, cancel or error
        */
        _investmentFailed: {
          type: Boolean,
          value: false,
          computed: '_statusIsOneOf(subRouteData.status, ["reject", "cancel", "error"])'
        },
        }
      },
      /**
      * Returns whether argument status is similar to one of the strings in Array statusArray
      */
      _statusIsOneOf: function(status, statusArray) {
        var statusExists = statusArray.indexOf(status) !== -1;
        return statusExists;
      }
    });
  </script>
</dom-module>