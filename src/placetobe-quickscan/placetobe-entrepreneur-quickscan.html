<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/placetobe-button/placetobe-button.html">
<link rel="import" href="../placetobe-styles/placetobe-styles.html">

<dom-module id="placetobe-entrepreneur-quickscan">

  <template>
    <style>
      :host {
      }

      :host h3 {
        @apply(--placetobe-heading4);
        margin-bottom: 18px;
        font-weight: 400;
      }

      @media (max-width: 959px) {
        :host h3 {
          @apply(--placetobe-heading4);
          margin-bottom: 18px;
        }
      }

      :host h6, article  {
        @apply(--placetobe-body);
        margin-bottom: 9px;
      }

      @media (max-width: 959px) {
        :host h6, article {
          @apply(--placetobe-body--phone);
        }        
      }

      :host iron-selector {
        list-style: none;
        padding: 0;
        margin-bottom: 36px;
        display: block;
      }

      :host iron-selector button {
        @apply(--placetobe-body);
        margin-bottom: 9px;
        padding-left: 54px;
        position: relative;
        background-color: transparent;
        display: block;
        border:0;
        outline: none;
        cursor: pointer;
      }

      @media (max-width: 959px) {
        :host iron-selector button {
          @apply(--placetobe-body--phone);
          margin-bottom: 6px;
        }        
      }


      :host iron-selector button:before {
        position: absolute;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        top: 3px;
        left: 0;
        background-color: white;
        content: "";
      }

      @media (max-width: 959px) {
        :host iron-selector button:before {
          @apply(--placetobe-body--phone);
          top: 3px;
        }        
      }


      :host iron-selector button:hover:before {
        background-color: #ddd;
      }

      :host iron-selector button.iron-selected:before {
        background-color: black;
      }

      :host #try-again-button {
        display: block;
        --text-color: white;
      }

    </style>

    <template is="dom-if" if="[[!finished]]">

        <h6>[[currentStep]] van [[numberOfQuestions]]</h6>
            
        <span hidden="[[!_atIndex(0, currentIndex)]]">
            <h3>Ik wil mijn bedrijf<strong>starten</strong> of <strong>uitbreiden</strong></h3>
            <iron-selector selected="{{answers.0}}" attr-for-selected="value">
                <button value="1">Totaal onbelangrijk</button>
                <button value="2">Redelijk onbelangrijk</button>
                <button value="3">Neutraal</button>
                <button value="4">Redelijk belangrijk</button>
                <button value="5">Heel belangrijk</button>
            </iron-selector>
        </span>

        <span hidden="[[!_atIndex(1, currentIndex)]]">
            <h3>Ik wil bestaande <strong>chulden herstructureren</strong> of <strong>-financieren</strong></h3>
            <iron-selector selected="{{answers.1}}" attr-for-selected="value">
                <button value="5">Totaal onbelangrijk</button>
                <button value="4">Redelijk onbelangrijk</button>
                <button value="3">Neutraal</button>
                <button value="2">Redelijk belangrijk</button>
                <button value="1">Heel belangrijk</button>
            </iron-selector>
        </span>

        <span hidden="[[!_atIndex(2, currentIndex)]]">
            <h3>Hoeveel mensen, klanten, vrienden, sympathisanten ken je die wel in mijn bedrijf willen investeren?</h3>
            <iron-selector selected="{{answers.2}}" attr-for-selected="value">
                <button value="1">Geen</button>
                <button value="2">Enkele</button>
                <button value="2">Best wel wat</button>
                <button value="4">Behoorlijk veel</button>
                <button value="5">Heel veel</button>
            </iron-selector>
        </span>

        <span hidden="[[!_atIndex(3, currentIndex)]]">
            <h3>Ik kan en wil een goede rente bieden als mensen in mijn bedrijf investeren</h3>
            <iron-selector selected="{{answers.4}}" attr-for-selected="value">
                <button value="1">Totaal niet</button>
                <button value="2">Ik denk van niet</button>
                <button value="3">Geen idee</button>
                <button value="4">Waarschijnlijk wel</button>
                <button value="5">Absoluut</button>
            </iron-selector>
        </span>

        <span hidden="[[!_atIndex(4, currentIndex)]]">
            <h3>Ik vertel graag het verhaal van mijn onderneming en de mensen die ik daarmee blij maak</h3>
            <iron-selector selected="{{answers.5}}" attr-for-selected="value">
                <button value="1">Nee</button>
                <button value="2">Liever niet</button>
                <button value="3">Zou kunnen</button>
                <button value="4">Waarschijnlijk wel</button>
                <button value="5">Absoluut</button>
            </iron-selector>
        </span>

        <placetobe-button
            title="vorige"
            on-tap="back"
            disabled="[[_atIndex(0, currentIndex)]]"
        ><span>vorige</span></placetobe-button>

        <placetobe-button
            title="volgende"
            on-tap="forward"
            hidden="[[!_atIndex(0, currentIndex)]]"
            disabled="[[!answers.0]]"
        ><span>volgende</span></placetobe-button>

        <placetobe-button
            title="volgende"
            on-tap="forward"
            hidden="[[!_atIndex(1, currentIndex)]]"
            disabled="[[!answers.1]]"
        ><span>volgende</span></placetobe-button>

        <placetobe-button
            title="volgende"
            on-tap="forward"
            hidden="[[!_atIndex(2, currentIndex)]]"
            disabled="[[!answers.2]]"
        ><span>volgende</span></placetobe-button>

        <placetobe-button
            title="volgende"
            on-tap="forward"
            hidden="[[!_atIndex(3, currentIndex)]]"
            disabled="[[!answers.3]]"
        ><span>volgende</span></placetobe-button>

        <placetobe-button
            title="bekijk resultaat"
            on-tap="forward"
            hidden="[[!_atIndex(4, currentIndex)]]"
            disabled="[[!answers.4]]"
        ><span>bekijk resultaat</span></placetobe-button>

    </template>

    <template is="dom-if" if="[[finished]]">

        <h6>conclusie</h6>
        
        <h3 hidden$="[[!_scoreIsLessThan(score, 10)]]"><strong>Je bent geen crowdfunder.</strong></h3>
        <h3 hidden$="[[!_scoreIsBetween(score, 9, 18)]]"><strong>Jij bent een potentiÃ«le crowdfunder!</strong></h3>
        <h3 hidden$="[[!_scoreIsGreaterThan(score, 17)]]"><strong>Jij bent een supercrowdfunder!</strong></h3>
        
        <article>[[answerText]]</p></article>

        <placetobe-button
            hidden$="[[_scoreIsLessThan(score, 10)]]"
            title="Meld je aan als investeerder"
            href="/investeren/aanmelden"
        ><span>Meld je aan als investeerder</span></placetobe-button>

        <placetobe-button
            id="try-again-button"
            title="Doe de scan opnieuw"
            on-tap="reset"
            link
        ><span>Doe de scan opnieuw</span></placetobe-button>

    </template>

  </template>

  <script>
    Polymer({
      
      is: 'placetobe-entrepreneur-quickscan',
      
      properties: {
        
        answers: {
            type: Object,
            value: {}
        },

        currentIndex: {
            type: Number,
            value: 0,
            readOnly: true
        },

        numberOfQuestions: {
            type: Number,
            value: 5
        },

        currentStep: {
            type: Number,
            computed: "_computeStep(currentIndex)"
        },

        finished: {
            type: Boolean,
            computed: "_computeFinished(answers.*, numberOfQuestions, currentIndex)"
        },

        answerText: {
            type: String,
            computed: "_computeAnswerText(answers.*, numberOfQuestions)"
        },

        score: {
            type: Number,
            computed: "_computeScore(answers.*, numberOfQuestions)"
        }

      },

      back: function() {
        if(this.currentIndex > 0) this._setCurrentIndex(this.currentIndex-1);
      },

      forward: function() {
        if(this.currentIndex < (this.numberOfQuestions)) this._setCurrentIndex(this.currentIndex+1);
      },

      reset: function() {
        this.set("answers", {});
        this._setCurrentIndex(0);
      },

      _atIndex: function(i, currentIndex) {
        return (i == currentIndex)
      },

      _computeStep: function(currentIndex) {
        return (currentIndex+1)
      },

      _computeFinished: function(answer, numberOfQuestions, currentIndex) {
        var answers = answer.base;
        for(var i=0;i<numberOfQuestions;i++) {
            if(answers[i] === undefined) return false;
        }
        return (currentIndex == numberOfQuestions)
      },

      _computeScore: function(answer, numberOfQuestions) {
        var score = 0;
        var answers = answer.base;
        for(var i=0;i<numberOfQuestions;i++) {
            score += parseInt(answers[i] || 0);
        }
        return score;
      },

      _scoreIsGreaterThan: function(score, greaterThan) {
        return (score > greaterThan);
      },

      _scoreIsLessThan: function(score, lessThan) {
        return (score < lessThan);
      },

      _scoreIsBetween: function(score, greaterThan, lessThan) {
        return (this._scoreIsGreaterThan(score, greaterThan) && this._scoreIsLessThan(score, lessThan));
      },

      _computeAnswerText: function(answer, numberOfQuestions) {
        var answerText = [];
        var answers = answer.base;
        for(var i=0;i<numberOfQuestions;i++) {
            if(answers[i]) answerText.push(this._getAnswerTextByIndexAndValue(i, parseInt(answers[i])));
        }
        return answerText.join(" ");
      },

      _getAnswerTextByIndexAndValue: function(index, value) {
        switch(index) {
            case 0:
                return this._getAnswerTextForQuestionOne(value);
                break;
            case 1:
                return this._getAnswerTextForQuestionTwo(value);
                break;
            case 2:
                return this._getAnswerTextForQuestionThree(value);
                break;
            case 3:
                //return this._getAnswerTextForQuestionFour(value);
                break;
            case 4:
                return this._getAnswerTextForQuestionFive(value);
                break;
        }
      },

      //Ik wil mijn bedrijf starten of uitbreiden
      _getAnswerTextForQuestionOne: function(value) {
        switch(value) {
            case 1:
            case 2:
                return "Je geeft aan dat rente krijgen op je geld niet zo belangrijk is.";
            case 3:
            case 4:
            case 5:
                return "Je wilt graag rendement op je geld maken.";
        }
      },

      //Ik wil bestaande schulden herstructureren of -financieren
      _getAnswerTextForQuestionTwo: function(value) {
        switch(value) {
            case 1:
            case 2:
                return "Wel vind je het belangrijk om elke dag bij je spaargeld te kunnen.";
            case 3:
            case 4:
            case 5:
                return "Je kent en accepteert de nadelen zoals het niet dagelijks geld kunnen opnemen van je spaarhgeld.";
        }
      },

      //Ik ken veel mensen, klanten, vrienden, sympathisanten, die wel in mijn bedrijf willen investeren
      _getAnswerTextForQuestionThree: function(value) {
        switch(value) {
            case 1:
            case 2:
                return "Ook wil je geen risico lopen geld kwijt te kunnen raken.";
            case 3:
            case 4:
            case 5:
                return "Je kent de risico's van verlies en laat de voordelen zwaarder wegen.";
        }
      },

      //Ik kan en wil een goede rente bieden als mensen in mijn bedrijf investeren
      _getAnswerTextForQuestionFour: function(value) {
        return "";
      },

      //Ik vertel graag het verhaal van mijn onderneming en de mensen die ik daarmee blij maak
      _getAnswerTextForQuestionFive: function(value) {
        switch(value) {
            case 1:
            case 2:
                return "Daarnaast voel je geen inhoudelijke betrokkenheid bij de projecten van ondernemers.";
            case 3:
            case 4:
            case 5:
                return "Ten slotte voel je je betrokken bij de ondernemers en hun plannen waarvoor crowdfunding nodig is..";
        }
      },


    });
  </script>
</dom-module>
