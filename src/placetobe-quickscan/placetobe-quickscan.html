<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../placetobe-styles/placetobe-styles.html">
<link rel="import" href="../placetobe-button/placetobe-button.html">

<dom-module id="placetobe-quickscan">

  <template>
    <style>
      :host {

      }

      :host h3 {
        @apply(--placetobe-heading3);
        margin-bottom: 18px;
      }

      :host h6, article  {
        @apply(--placetobe-body);
        margin-bottom: 9px;
      }

      :host iron-selector {
        list-style: none;
        padding: 0;
        margin-bottom: 36px;
        display: block;
      }

      :host iron-selector button {
        @apply(--placetobe-body);
        margin-bottom: 9px;
        padding-left: 54px;
        position: relative;
        background-color: transparent;
        display: block;
        border:0;
        outline: none;
        cursor: pointer;
      }

      :host iron-selector button:before {
        position: absolute;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        top: 9px;
        left: 0;
        background-color: white;
        content: "";
      }

      :host iron-selector button:hover:before {
        background-color: #ddd;
      }

      :host iron-selector button.iron-selected:before {
        background-color: black;
      }
    </style>

    <template is="dom-if" if="[[!finished]]">

        <h6>[[currentStep]] van [[numberOfQuestions]]</h6>

        <template is="dom-if" if="[[_isTarget('investors', target)]]">
            
            <span hidden="[[!_atIndex(0, currentIndex)]]">
                <h3>Ik wil rente verdienen op mijn geld</h3>
                <iron-selector selected="{{answers.0}}" attr-for-selected="value">
                    <button value="1">Totaal onbelangrijk</button>
                    <button value="2">Redelijk onbelangrijk</button>
                    <button value="3">Neutraal</button>
                    <button value="4">Redelijk belangrijk</button>
                    <button value="5">Heel belangrijk</button>
                </iron-selector>
            </span>

            <span hidden="[[!_atIndex(1, currentIndex)]]">
                <h3>Ik wil iedere dag mijn spaargeld kunnen opnemen</h3>
                <iron-selector selected="{{answers.1}}" attr-for-selected="value">
                    <button value="5">Totaal onbelangrijk</button>
                    <button value="4">Redelijk onbelangrijk</button>
                    <button value="3">Neutraal</button>
                    <button value="2">Redelijk belangrijk</button>
                    <button value="1">Heel belangrijk</button>
                </iron-selector>
            </span>

            <span hidden="[[!_atIndex(2, currentIndex)]]">
                <h3>Ik wil geen enkel risico lopen dat ik geld verllies</h3>
                <iron-selector selected="{{answers.2}}" attr-for-selected="value">
                    <button value="5">Totaal onbelangrijk</button>
                    <button value="4">Redelijk onbelangrijk</button>
                    <button value="3">Neutraal</button>
                    <button value="2">Redelijk belangrijk</button>
                    <button value="1">Heel belangrijk</button>
                </iron-selector>
            </span>

            <span hidden="[[!_atIndex(3, currentIndex)]]">
                <h3>Ik wil een hoog rendement maken</h3>
                <iron-selector selected="{{answers.3}}" attr-for-selected="value">
                    <button value="1">Totaal onbelangrijk</button>
                    <button value="2">Redelijk onbelangrijk</button>
                    <button value="3">Neutraal</button>
                    <button value="4">Redelijk belangrijk</button>
                    <button value="5">Heel belangrijk</button>
                </iron-selector>
            </span>

            <span hidden="[[!_atIndex(4, currentIndex)]]">
                <h3>Ik wil deelnemen in de verhalen van ondernemers</h3>
                <iron-selector selected="{{answers.4}}" attr-for-selected="value">
                    <button value="1">Totaal onbelangrijk</button>
                    <button value="2">Redelijk onbelangrijk</button>
                    <button value="3">Neutraal</button>
                    <button value="4">Redelijk belangrijk</button>
                    <button value="5">Heel belangrijk</button>
                </iron-selector>
            </span>

        </template>
        
        <template is="dom-if" if="[[_isTarget('entrepreneurs', target)]]">

            <span hidden="[[!_atIndex(0, currentIndex)]]">
                <h3>Wat voor financiering zoek je?</h3>
                <iron-selector selected="{{answers.0}}" attr-for-selected="value">
                    <button value="#0">Eigen vermogen</button>
                    <button value="#1">Vreemd vermogen</button>
                    <button value="#2">Voorverkoop</button>
                    <button value="#3">Donaties</button>
                    <button value="#4">Weet ik niet</button>
                </iron-selector>
            </span>

            <span hidden="[[!_atIndex(1, currentIndex)]]">
                <h3>Hoe lang sta je al ingeschreven bij de KvK?</h3>
                <iron-selector selected="{{answers.1}}" attr-for-selected="value">
                    <button value="#0">De onderneming is nog niet ingeschreven</button>
                    <button value="#1">0-1 jaar</button>
                    <button value="#2">1-3 jaar</button>
                    <button value="#3">3-5 jaar</button>
                    <button value="#4">meer dan 5 jaar</button>
                </iron-selector>
            </span>

            <span hidden="[[!_atIndex(2, currentIndex)]]">
                <h3>Wat is je voornaamste persoonlijke inkomstenbron?</h3>
                <iron-selector selected="{{answers.2}}" attr-for-selected="value">
                    <button value="#0">Kan volledig rondkomen van de onderneming</button>
                    <button value="#1">In loondienst</button>
                    <button value="#2">Student</button>
                    <button value="#3">Werkzoekend</button>
                    <button value="#4">Anders</button>
                </iron-selector>
            </span>

            <span hidden="[[!_atIndex(3, currentIndex)]]">
                <h3>Hoeveel klanten heb je per maand?</h3>
                <iron-selector selected="{{answers.3}}" attr-for-selected="value">
                    <button value="#0">0-10</button>
                    <button value="#1">10-100</button>
                    <button value="#2">100-500</button>
                    <button value="#3">500-1000</button>
                    <button value="#4">Meer dan 1000</button>
                </iron-selector>
            </span>

            <span hidden="[[!_atIndex(4, currentIndex)]]">
                <h3>Hoe actief is je Facebook-pagina?</h3>
                <iron-selector selected="{{answers.4}}" attr-for-selected="value">
                    <button value="#0">Niet actief</button>
                    <button value="#1">Wel actief, 0-100 likes</button>
                    <button value="#2">Wel actief, 500 likes</button>
                    <button value="#3">Wel actief, meer dan 500 likes</button>
                </iron-selector>
            </span>

        </template>

        <placetobe-button
            label="vorige"
            on-tap="back"
            disabled="[[_atIndex(0, currentIndex)]]"
        ></placetobe-button>

        <placetobe-button
            label="volgende"
            on-tap="forward"
            hidden="[[!_atIndex(0, currentIndex)]]"
            disabled="[[!answers.0]]"
        ></placetobe-button>

        <placetobe-button
            label="volgende"
            on-tap="forward"
            hidden="[[!_atIndex(1, currentIndex)]]"
            disabled="[[!answers.1]]"
        ></placetobe-button>

        <placetobe-button
            label="volgende"
            on-tap="forward"
            hidden="[[!_atIndex(2, currentIndex)]]"
            disabled="[[!answers.2]]"
        ></placetobe-button>

        <placetobe-button
            label="volgende"
            on-tap="forward"
            hidden="[[!_atIndex(3, currentIndex)]]"
            disabled="[[!answers.3]]"
        ></placetobe-button>

        <placetobe-button
            label="bekijk resultaat"
            on-tap="forward"
            hidden="[[!_atIndex(4, currentIndex)]]"
            disabled="[[!answers.4]]"
        ></placetobe-button>

    </template>

    <template is="dom-if" if="[[finished]]">

        <h6>conclusie</h6>
        
        <h3 hidden$="[[!_scoreIsLessThan(score, 10)]]">Je bent geen crowdfunder.</h3>
        <h3 hidden$="[[!_scoreIsBetween(score, 9, 18)]]">Jij bent een potentiÃ«le crowdfunder!</h3>
        <h3 hidden$="[[!_scoreIsGreaterThan(score, 17)]]">Jij bent een supercrowdfunder!</h3>
        
        <article>[[answerText]]</p></article>

        <placetobe-button
            label="Doe de scan opnieuw"
            on-tap="reset"
        ></placetobe-button>

    </template>

  </template>

  <script>
    Polymer({
      
      is: 'placetobe-quickscan',
      
      properties: {
        
        answers: {
            type: Object,
            value: {}
        },

        currentIndex: {
            type: Number,
            value: 0,
            readOnly: true
        },

        numberOfQuestions: {
            type: Number,
            value: 5
        },

        currentStep: {
            type: Number,
            computed: "_computeStep(currentIndex)"
        },

        target: String,

        finished: {
            type: Boolean,
            computed: "_computeFinished(answers.*, numberOfQuestions, currentIndex)"
        },

        answerText: {
            type: String,
            computed: "_computeAnswerText(answers.*, numberOfQuestions)"
        },

        score: {
            type: Number,
            computed: "_computeScore(answers.*, numberOfQuestions)"
        }

      },

      back: function() {
        if(this.currentIndex > 0) this._setCurrentIndex(this.currentIndex-1);
      },

      forward: function() {
        if(this.currentIndex < (this.numberOfQuestions)) this._setCurrentIndex(this.currentIndex+1);
      },

      reset: function() {
        this.set("answers", {});
        this._setCurrentIndex(0);
      },

      _atIndex: function(i, currentIndex) {
        return (i == currentIndex)
      },

      _computeStep: function(currentIndex) {
        return (currentIndex+1)
      },

      _isTarget: function(targetName, target) {
        return (targetName === target)
      },

      _computeFinished: function(answer, numberOfQuestions, currentIndex) {
        var answers = answer.base;
        for(var i=0;i<numberOfQuestions;i++) {
            if(answers[i] === undefined) return false;
        }
        return (currentIndex == numberOfQuestions)
      },

      _computeScore: function(answer, numberOfQuestions) {
        var score = 0;
        var answers = answer.base;
        for(var i=0;i<numberOfQuestions;i++) {
            score += parseInt(answers[i] || 0);
        }
        return score;
      },

      _scoreIsGreaterThan: function(score, greaterThan) {
        return (score > greaterThan);
      },

      _scoreIsLessThan: function(score, lessThan) {
        return (score < lessThan);
      },

      _scoreIsBetween(score, greaterThan, lessThan) {
        return (this._scoreIsGreaterThan(score, greaterThan) && this._scoreIsLessThan(score, lessThan));
      },

      _computeAnswerText: function(answer, numberOfQuestions) {
        var answerText = [];
        var answers = answer.base;
        for(var i=0;i<numberOfQuestions;i++) {
            if(answers[i]) answerText.push(this._getAnswerTextByIndexAndValue(i, parseInt(answers[i])));
        }
        return answerText.join(" ");
      },

      _getAnswerTextByIndexAndValue: function(index, value) {
        switch(index) {
            case 0:
                return this._getAnswerTextForQuestionOne(value);
                break;
            case 1:
                return this._getAnswerTextForQuestionTwo(value);
                break;
            case 2:
                return this._getAnswerTextForQuestionThree(value);
                break;
            case 3:
                //return this._getAnswerTextForQuestionFour(value);
                break;
            case 4:
                return this._getAnswerTextForQuestionFive(value);
                break;
        }
      },

      //Ik wil rente verdienen op mijn geld
      _getAnswerTextForQuestionOne: function(value) {
        switch(value) {
            case 1:
            case 2:
                return "Je geeft aan dat rente krijgen op je geld niet zo belangrijk is.";
            case 3:
            case 4:
            case 5:
                return "Je wilt graag rendement op je geld maken.";
        }
      },

      //Ik wil iedere dag mijn spaargeld kunnen opnemen
      _getAnswerTextForQuestionTwo: function(value) {
        switch(value) {
            case 1:
            case 2:
                return "Wel vind je het belangrijk om elke dag bij je spaargeld te kunnen.";
            case 3:
            case 4:
            case 5:
                return "Je kent en accepteert de nadelen zoals het niet dagelijks geld kunnen opnemen van je spaarhgeld.";
        }
      },

      //Ik wil geen enkel risico lopen dat ik geld verllies
      _getAnswerTextForQuestionThree: function(value) {
        switch(value) {
            case 1:
            case 2:
                return "Ook wil je geen risico lopen geld kwijt te kunnen raken.";
            case 3:
            case 4:
            case 5:
                return "Je kent de risico's van verlies en laat de voordelen zwaarder wegen.";
        }
      },

      //Ik wil een hoog rendement maken
      _getAnswerTextForQuestionFour: function(value) {
        return "";
      },

      //Ik wil deelnemen in de verhalen van ondernemers
      _getAnswerTextForQuestionFive: function(value) {
        switch(value) {
            case 1:
            case 2:
                return "Daarnaast voel je geen inhoudelijke betrokkenheid bij de projecten van ondernemers.";
            case 3:
            case 4:
            case 5:
                return "Ten slotte voel je je betrokken bij de ondernemers en hun plannen waarvoor crowdfunding nodig is..";
        }
      },


    });
  </script>
</dom-module>
